<!DOCTYPE html>
<html lang="hu">
<head>
    </head>
<body>
    <div class="container">
        <h1>Videó Feliratozó (Gemini 1.5)</h1>
        
        <div id="player-container">
            </div>

        <div id="log-container">
            <label for="log-output">Szerver Log (Valós Idejű)</label>
            <textarea id="log-output" readonly></textarea>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        const processBtn = document.getElementById('processBtn');
        const logOutput = document.getElementById('log-output');
        const playerContainer = document.getElementById('player-container');
        const downloadLink = document.getElementById('downloadLink');
        const player = videojs('my-video');
        // ... többi elem definíciója

        processBtn.addEventListener('click', async () => {
            // ... bemeneti adatok összegyűjtése (API kulcs, URL, stb.) ...

            // === ÚJ LOGIKA KEZDETE ===
            logOutput.value = '';
            processBtn.disabled = true;
            playerContainer.style.display = 'none';

            // 1. Elindítjuk a feldolgozást és kapunk egy job_id-t
            const startResponse = await fetch('/process-video', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ /* ... adatok ... */ }),
            });
            const startData = await startResponse.json();
            const jobId = startData.job_id;

            // 2. Feliratkozunk a log csatornára
            const eventSource = new EventSource(`/stream-logs/${jobId}`);
            logOutput.value = "Kapcsolódva a log stream-hez...\n";

            // 3. Figyeljük a bejövő üzeneteket
            eventSource.onmessage = function(event) {
                logOutput.value += event.data + "\n";
                // Automatikus görgetés az aljára
                logOutput.scrollTop = logOutput.scrollHeight;
            };

            // 4. Figyeljük a speciális 'result' eseményt, ami a végét jelzi
            eventSource.addEventListener('result', function(event) {
                eventSource.close(); // Lezárjuk a kapcsolatot
                processBtn.disabled = false;
                
                const resultData = JSON.parse(event.data);

                if (resultData.status === 'success') {
                    playerContainer.style.display = 'block';
                    // ... lejátszó és letöltési link beállítása a resultData alapján ...
                } else {
                    logOutput.value += `\nHIBA: ${resultData.message}\n`;
                }
            });

            // Hibakezelés
            eventSource.onerror = function() {
                logOutput.value += "\nHiba a log stream kapcsolatban. A kapcsolat lezárult.\n";
                eventSource.close();
                processBtn.disabled = false;
            };
        });
    </script>
</body>
</html>
