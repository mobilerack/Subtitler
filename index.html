<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Videó Feliratozó</title>
    <style>
        /* A CSS változatlan marad */
    </style>
</head>
<body>
    <div class="container">
        <h1>Videó Feliratozó</h1>
        
        <div class="input-group">
            <label for="speechmaticsApiKeyInput">Speechmatics API Kulcs</label>
            <input type="password" id="speechmaticsApiKeyInput">
        </div>
        <div class="input-group">
            <label for="geminiApiKeyInput">Google Gemini API Kulcs</label>
            <input type="password" id="geminiApiKeyInput">
        </div>
        <div class="input-group">
            <label for="videoUrlInput">Videó URL</label>
            <input type="text" id="videoUrlInput">
        </div>
        <div class="input-group">
            <label for="directUrlOutput">Közvetlen Média URL</label>
            <input type="text" id="directUrlOutput" disabled>
        </div>
        <div class="input-group">
            <label for="languageSelect">Videó Eredeti Nyelve</label>
            <select id="languageSelect">
                </select>
        </div>

        <div class="input-group">
            <button id="getLinkBtn">1. Link Lekérése</button>
        </div>
        <div class="input-group">
            <button id="processBtn" disabled>2. Feliratozás és Letöltés</button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        // === TELJESEN ÚJ JAVASCRIPT LOGIKA ===
        const getLinkBtn = document.getElementById('getLinkBtn');
        const processBtn = document.getElementById('processBtn');
        const directUrlOutput = document.getElementById('directUrlOutput');
        const statusDiv = document.getElementById('status');
        // ... többi elem definíciója

        // API kulcsok mentése/betöltése változatlan
        // ...

        // 1. GOMB: Link lekérése
        getLinkBtn.addEventListener('click', async () => {
            const videoUrl = document.getElementById('videoUrlInput').value;
            if (!videoUrl) {
                alert('Kérlek, adj meg egy videó URL-t!');
                return;
            }

            statusDiv.style.display = 'block';
            statusDiv.textContent = 'Közvetlen link keresése...';
            getLinkBtn.disabled = true;
            processBtn.disabled = true;

            try {
                const response = await fetch('/api/get-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: videoUrl }),
                });

                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Ismeretlen hiba a link kinyerése során.');
                }
                
                directUrlOutput.value = data.direct_url;
                statusDiv.textContent = 'Sikeres link kinyerés! Most már indíthatod a feldolgozást.';
                processBtn.disabled = false; // Elérhetővé tesszük a második gombot

            } catch (error) {
                statusDiv.textContent = `Hiba: ${error.message}`;
            } finally {
                getLinkBtn.disabled = false;
            }
        });

        // 2. GOMB: Teljes feldolgozás indítása
        processBtn.addEventListener('click', async () => {
            const speechmaticsApiKey = document.getElementById('speechmaticsApiKeyInput').value;
            const geminiApiKey = document.getElementById('geminiApiKeyInput').value;
            const directUrl = directUrlOutput.value; // Most már innen olvassuk
            const language = document.getElementById('languageSelect').value;
            const videoTitle = "video"; // Ezt később a /get-url is visszaadhatná

            if (!speechmaticsApiKey || !geminiApiKey || !directUrl) {
                alert('Minden mező kitöltése szükséges a feldolgozáshoz!');
                return;
            }

            statusDiv.textContent = 'Teljes feldolgozás indul...';
            processBtn.disabled = true;

            try {
                const response = await fetch('/api/process-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        directUrl: directUrl,
                        speechmaticsApiKey: speechmaticsApiKey,
                        geminiApiKey: geminiApiKey,
                        language: language,
                        videoTitle: videoTitle
                    }),
                });

                if (response.ok) {
                    // A letöltési logika változatlan...
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Ismeretlen hiba a szerveren.');
                }

            } catch (error) {
                statusDiv.textContent = `Hiba: ${error.message}`;
            } finally {
                processBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
